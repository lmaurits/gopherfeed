#!/usr/bin/env python
# Copyright (c) 2013, Luke Maurits <luke@maurits.id.au>
# Published under the terms of the BSD 3-Clause License
# (see LICENSE file or http://opensource.org/licenses/BSD-3-Clause)

import gopherfeed

import codecs
import getopt
import sys

def usage():
    print """Usage: gopherfeed feed_url [gophermap_filename]\n"""

def main():
    opts, args = getopt.gnu_getopt(sys.argv[1:], "")
    if len(args) not in (1,2):
        usage()
        sys.exit(2)
    feed_url = args[0]
    gophermap = gopherfeed.gopherize_feed(feed_url)
    if len(args) == 2:
        filename = args[1]
        try:
            with codecs.open(filename, "w", "UTF-8") as fp:
                fp.write(gophermap)
        except IOError as e:
            print "Could not write gophermap to file %s: %s" % (filename, e.strerror)
            exit(1)
    else:
        print gophermap

if __name__ == "__main__":
    main()
